{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="p-5 mb-4 bg-primary rounded-3 shadow-lg text-center text-white hero-dashboard">
        <h1 class="display-4 fw-bold">Bem-vindo, {{ session['username'] }}! <i class="fas fa-hand-peace ms-2"></i></h1>
        <p class="lead">Simplifique seu controle de glicemia e gerencie seu diabetes de forma eficiente.</p>
        <hr class="my-4">
        <p>Acesse as ferramentas e calculadoras abaixo para um acompanhamento mais completo.</p>
    </div>

    {% if resumo_dados['ultimo_registro'] %}
    <h2 class="text-center mt-5 mb-4 text-secondary">Seu Resumo Rápido</h2>
    <div class="row row-cols-1 row-cols-md-3 g-4 mb-5">
        <div class="col">
            <div
                class="dashboard-card text-center shadow-sm card-glicemia-{{ resumo_dados['ultimo_registro']['status'] }}">
                <div class="card-body">
                    <i class="fas fa-arrow-circle-right fa-3x mb-3 text-white"></i>
                    <h5 class="card-title text-white">Último Registro</h5>
                    <h2 class="card-text display-6 fw-bold text-white">{{ resumo_dados['ultimo_registro']['valor'] }}
                        mg/dL</h2>
                    <p class="card-text text-white"><small>{{ resumo_dados['tempo_desde_ultimo'] }}</small></p>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="dashboard-card bg-light text-center shadow-sm">
                <div class="card-body">
                    <i class="fas fa-chart-bar fa-3x mb-3 text-primary"></i>
                    <h5 class="card-title text-secondary">Média (Últimos 7 Dias)</h5>
                    <h2 class="card-text display-6 fw-bold text-dark">
                        {% if resumo_dados['media_ultima_semana'] %}
                        {{ resumo_dados['media_ultima_semana'] }} mg/dL
                        {% else %}
                        N/A
                        {% endif %}
                    </h2>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="dashboard-card bg-light text-center shadow-sm">
                <div class="card-body">
                    <i class="fas fa-exclamation-triangle fa-3x mb-3 text-danger"></i>
                    <h5 class="card-title text-secondary">Eventos Extremos</h5>
                    <p class="card-text fs-5 fw-bold">
                        <span class="text-warning">Hiper: {{ resumo_dados['hiperglicemia_count'] }}</span>
                        <span class="mx-2 text-muted">|</span>
                        <span class="text-danger">Hipo: {{ resumo_dados['hipoglicemia_count'] }}</span>
                    </p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <h2 class="text-center mt-5 mb-4 text-secondary">Ferramentas Diárias</h2>
    <div class="row row-cols-1 row-cols-md-2 g-4 justify-content-center">
        <div class="col">
            <div class="dashboard-card h-100 shadow-sm border-0 tool-card bg-white">
                <div class="card-body d-flex flex-column align-items-center text-center">
                    <i class="fas fa-notes-medical fa-3x mb-3 text-success"></i>
                    <h5 class="card-title">Registrar Glicemia e Refeição</h5>
                    <p class="card-text text-muted">Adicione seus novos registros e acompanhe seu progresso diário.</p>
                    <a href="{{ url_for('registrar_refeicao') }}" class="btn btn-outline-success mt-auto">
                        <i class="fas fa-plus-circle me-2"></i>Registrar
                    </a>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="dashboard-card h-100 shadow-sm border-0 tool-card bg-white">
                <div class="card-body d-flex flex-column align-items-center text-center">
                    <i class="fas fa-chart-line fa-3x mb-3 text-primary"></i>
                    <h5 class="card-title">Ver Registros</h5>
                    <p class="card-text text-muted">Visualize, edite e acompanhe seu histórico de glicemia e refeições.
                    </p>
                    <a href="{{ url_for('registros') }}" class="btn btn-outline-primary mt-auto">
                        <i class="fas fa-eye me-2"></i>Ver Registros
                    </a>
                </div>
            </div>
        </div>
    </div>

    <hr class="my-5">

    <h2 class="text-center mb-4 text-secondary">Calculadoras</h2>
    <div class="row row-cols-1 row-cols-md-2 g-4 justify-content-center">
        <div class="col">
            <div class="dashboard-card h-100 shadow-sm border-0 tool-card bg-white">
                <div class="card-body d-flex flex-column align-items-center text-center">
                    <i class="fas fa-calculator fa-3x mb-3 text-info"></i>
                    <h5 class="card-title">Calcular Bolus</h5>
                    <p class="card-text text-muted">Calcule a dose de insulina para sua refeição e correção de glicemia.
                    </p>
                    <a href="{{ url_for('calculadora_bolus') }}" class="btn btn-outline-info mt-auto">
                        <i class="fas fa-calculator me-2"></i>Calcular
                    </a>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="dashboard-card h-100 shadow-sm border-0 tool-card bg-white">
                <div class="card-body d-flex flex-column align-items-center text-center">
                    <i class="fas fa-microscope fa-3x mb-3 text-dark"></i>
                    <h5 class="card-title">Calcular Fator de Sensibilidade</h5>
                    <p class="card-text text-muted">Descubra seu Fator de Sensibilidade à Insulina com base no seu DTDI.
                    </p>
                    <a href="{{ url_for('calcular_fs') }}" class="btn btn-outline-dark mt-auto">
                        <i class="fas fa-hand-point-right me-2"></i>Calcular
                    </a>
                </div>
            </div>
        </div>
    </div>

    <hr class="my-5">

    <h2 class="text-center mb-4 text-secondary">Recursos e Informações</h2>
    <div class="row row-cols-1 row-cols-md-2 g-4 justify-content-center">
        <div class="col">
            <div class="dashboard-card h-100 shadow-sm border-0 tool-card bg-white">
                <div class="card-body d-flex flex-column align-items-center text-center">
                    <i class="fas fa-book-medical fa-3x mb-3 text-secondary"></i>
                    <h5 class="card-title">Guia Completo sobre Insulina</h5>
                    <p class="card-text text-muted">Leia nosso guia detalhado e aprenda mais sobre o uso e tipos de
                        insulina.</p>
                    <a href="{{ url_for('guia_insulina') }}" class="btn btn-outline-secondary mt-auto">
                        <i class="fas fa-book me-2"></i>Abrir Guia
                    </a>
                </div>
            </div>
        </div>
    </div>

    {% if session.get('role') == 'admin' %}
    <hr class="my-5">
    <h2 class="text-center mb-4 text-secondary">Painel do Administrador</h2>
    <div class="row row-cols-1 row-cols-md-2 g-4 justify-content-center">
        <div class="col">
            <div class="dashboard-card h-100 shadow-sm border-0 tool-card bg-white">
                <div class="card-body d-flex flex-column align-items-center text-center">
                    <i class="fas fa-users-cog fa-3x mb-3 text-warning"></i>
                    <h5 class="card-title">Gerenciar Usuários</h5>
                    <p class="card-text text-muted">Adicione, edite ou remova usuários do sistema.</p>
                    <a href="{{ url_for('gerenciar_usuarios') }}" class="btn btn-outline-warning mt-auto">
                        <i class="fas fa-user-plus me-2"></i>Gerenciar
                    </a>
                </div>
            </div>
        </div>
        <div class="col">
            <div class="dashboard-card h-100 shadow-sm border-0 tool-card bg-white">
                <div class="card-body d-flex flex-column align-items-center text-center">
                    <i class="fas fa-apple-alt fa-3x mb-3 text-danger"></i>
                    <h5 class="card-title">Registrar Alimento</h5>
                    <p class="card-text text-muted">Adicione novos alimentos à base de dados para uso nas refeições.</p>
                    <a href="{{ url_for('registrar_alimento') }}" class="btn btn-outline-danger mt-auto">
                        <i class="fas fa-plus me-2"></i>Registrar
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}