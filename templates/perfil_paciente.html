{% extends 'base.html' %}

{% block title %}Perfil do Paciente - {{ paciente.username }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>Perfil do Paciente: {{ paciente.username }}</h2>
        <div>
            <a href="{{ url_for('ficha_medica', username=paciente.username) }}"
                class="btn btn-primary me-2">
                <i class="fas fa-file-medical me-2"></i>Ficha Médica
                </a>
            <a href="{{ url_for('dashboard_medico') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left me-2"></i>Voltar
                </a>
            </div>
        </div>
    
    <div class="card shadow-sm mb-4">
         <div class="card-header bg-light">
            <h4 class="mb-0">Informações do Perfil</h4>
            </div>
        <div class="card-body">
            <p><strong>Email:</strong> {{ paciente.email or 'N/A' }}</p>
            <p><strong>Data de Nascimento:</strong> {{ paciente.data_nascimento or 'N/A' }}</p>
            <p><strong>Sexo:</strong> {{ paciente.sexo or 'N/A' }}</p>
            <p><strong>Razão I:C:</strong> {{ paciente.razao_ic or 'N/A' }}</p>
            <p><strong>Fator de Sensibilidade:</strong> {{ paciente.fator_sensibilidade or 'N/A' }}</p>
            </div>
        </div>

    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <h4 class="mb-0">Registros de Glicemia e Refeições</h4>
            </div>
        <div class="card-body">
            {% if registros %}
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead>
                        <tr>
                            <th>Data/Hora</th>
                            <th>Glicemia (mg/dL)</th>
                            <th>Carboidratos (g)</th>
                            <th>Calorias (kcal)</th>
                            <th>Ações</th>
                            </tr>
                        </thead>
                    <tbody>
                        {% for reg in registros %}
                        <tr>
                            <td>{{ reg.data_hora.strftime('%d/%m/%Y %H:%M') }}</td>
                            <td>
                                <span class="badge {{ get_status_class(reg.valor) }}">{{
                                    reg.valor }}</span>
                                </td>
                            <td>{{ reg.total_carbs }}</td>
                            <td>{{ reg.total_calorias }}</td>
                            <td>
                                <a href="{{ url_for('editar_registo', id=reg.id) }}"
                                    class="btn btn-sm btn-warning">Editar</a>
                                <a href="{{ url_for('excluir_registo', id=reg.id) }}"
                                    class="btn btn-sm btn-danger"
                                    onclick="return confirm('Tem certeza que deseja excluir este registro?');">Excluir</a>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
            <p class="text-muted">Nenhum registro encontrado para este paciente.</p>
            {% endif %}
            </div>
        </div>
</div>
{% endblock %}